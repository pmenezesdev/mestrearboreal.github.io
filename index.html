<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bazaar das Sombras</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=MedievalSharp&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a1a;
            background-image: url('https://www.transparenttextures.com/patterns/dark-matter.png');
            font-family: 'MedievalSharp', cursive;
        }
        .font-cinzel {
            font-family: 'Cinzel', serif;
        }
        .font-medieval {
            font-family: 'MedievalSharp', cursive;
        }
        .item-card {
            background-color: rgba(26, 26, 38, 0.7);
            border: 1px solid #4a4a68;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .item-card:hover {
            box-shadow: 0 0 20px rgba(180, 150, 255, 0.5);
            border-color: #b496ff;
        }
        .rarity-common { border-left: 5px solid #a3a3a3; }
        .rarity-uncommon { border-left: 5px solid #22c55e; }
        .rarity-rare { border-left: 5px solid #3b82f6; }
        .rarity-very-rare { border-left: 5px solid #a855f7; }
        .rarity-legendary { border-left: 5px solid #f97316; }

        .text-rarity-common { color: #a3a3a3; }
        .text-rarity-uncommon { color: #22c55e; }
        .text-rarity-rare { color: #3b82f6; }
        .text-rarity-very-rare { color: #a855f7; }
        .text-rarity-legendary { color: #f97316; }

        #searchInput {
            background-color: rgba(10, 10, 20, 0.6);
            border: 1px solid #4a4a68;
        }
        #searchInput:focus {
            border-color: #b496ff;
            box-shadow: 0 0 15px rgba(180, 150, 255, 0.3);
            outline: none;
        }
        .category-title {
            text-shadow: 1px 1px 3px #000;
        }
        #backToTopBtn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 99;
            border: 1px solid #b496ff;
            outline: none;
            background-color: rgba(26, 26, 38, 0.8);
            color: #b496ff;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 50%;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        #backToTopBtn:hover {
            background-color: #b496ff;
            color: #1a1a26;
        }
        .item-description {
            display: none;
            border-top: 1px solid #4a4a68;
            padding-top: 1rem;
            margin-top: 1rem;
            color: #d1d5db;
            font-family: sans-serif;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        .item-description p, .item-description ul { margin-bottom: 0.5rem; }
        .item-description ul { list-style-type: disc; padding-left: 1.5rem; }
        .item-description strong { color: #f3f4f6; }
        .item-description em { font-style: italic; color: #a5b4fc; }
    </style>
</head>
<body class="text-gray-200">

    <!-- Container Principal -->
    <div id="app" class="container mx-auto p-4 md:p-8">
        <!-- Cabeçalho da Loja -->
        <header class="text-center mb-12">
            <h1 class="text-5xl md:text-7xl font-bold font-cinzel text-yellow-300" style="text-shadow: 2px 2px 4px #000;">
                Bazaar das Sombras
            </h1>
            <p class="mt-4 text-lg text-gray-300 max-w-3xl mx-auto font-medieval">
                Bem-vindo, viajante dos planos! Em Sigil, a Cidade dos Portais, até os desejos mais arcanos encontram seu preço.
            </p>
        </header>

        <!-- Barra de Busca e Navegação -->
        <div class="sticky top-0 z-10 py-4 mb-8 backdrop-blur-md bg-gray-900/50 rounded-lg">
            <input type="text" id="searchInput" placeholder="Buscar por um item (em Português ou Inglês)..." class="w-full p-3 rounded-lg text-lg text-gray-200 focus:ring-2 focus:ring-purple-400 transition-all duration-300 ease-in-out">
            <nav class="flex flex-wrap justify-center gap-2 md:gap-4 mt-4">
                <a href="#consumables" class="px-3 py-1 bg-purple-900/50 rounded-full hover:bg-purple-800/80 transition-colors">Consumíveis</a>
                <a href="#combat" class="px-3 py-1 bg-red-900/50 rounded-full hover:bg-red-800/80 transition-colors">Combate</a>
                <a href="#noncombat" class="px-3 py-1 bg-blue-900/50 rounded-full hover:bg-blue-800/80 transition-colors">Utilitários</a>
                <a href="#summoning" class="px-3 py-1 bg-green-900/50 rounded-full hover:bg-green-800/80 transition-colors">Invocação</a>
                <a href="#gamechanging" class="px-3 py-1 bg-yellow-900/50 rounded-full hover:bg-yellow-800/80 transition-colors">Transformadores</a>
            </nav>
        </div>
        
        <main id="item-shop">
            <!-- Os itens serão carregados e renderizados aqui -->
        </main>
    </div>

    <!-- Botão Voltar ao Topo -->
    <button onclick="scrollToTop()" id="backToTopBtn" title="Voltar ao topo">▲</button>
    
    <script>
        let allItems = []; // Armazena todos os itens do JSON

        const categories = {
            consumables: { title: "Consumíveis", color: "purple", items: [] },
            combat: { title: "Itens de Combate", color: "red", items: [] },
            noncombat: { title: "Itens Utilitários", color: "blue", items: [] },
            summoning: { title: "Itens de Invocação", color: "green", items: [] },
            gamechanging: { title: "Itens Transformadores", color: "yellow", items: [] }
        };

        const rarityMap = {
            "Comum": "common", "Incomum": "uncommon", "Raro": "rare",
            "Muito Raro": "very-rare", "Lendário": "legendary"
        };
        
        const shopContainer = document.getElementById('item-shop');

        function renderItems(filter = '') {
            shopContainer.innerHTML = '';
            const filterLower = filter.toLowerCase();

            // Limpa as listas de itens das categorias antes de filtrar
            for (const key in categories) {
                categories[key].items = [];
            }
            
            // Distribui os itens filtrados nas categorias
            const filteredItems = allItems.filter(item => 
                item.name.toLowerCase().includes(filterLower) ||
                item.englishName.toLowerCase().includes(filterLower)
            );

            filteredItems.forEach(item => {
                if (categories[item.category]) {
                    categories[item.category].items.push(item);
                }
            });

            // Renderiza as seções de categoria
            for (const key in categories) {
                const category = categories[key];
                if (category.items.length > 0) {
                    const section = document.createElement('section');
                    section.id = key;
                    section.className = 'mb-16';

                    const title = document.createElement('h2');
                    title.className = `text-4xl font-cinzel font-bold mb-6 border-b-2 border-${category.color}-500/50 pb-2 text-${category.color}-300 category-title`;
                    title.textContent = category.title;
                    section.appendChild(title);
                    
                    const grid = document.createElement('div');
                    grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';
                    
                    category.items.forEach(item => {
                        const rarityClass = rarityMap[item.rarity] || 'common';
                        const priceDisplay = typeof item.price === 'number' && item.price > 0 ? `${item.price.toLocaleString('pt-BR')} PO` : (item.specialPrice || 'Preço Especial');
                        const card = document.createElement('div');
                        card.className = `item-card rounded-lg p-5 flex flex-col h-full rarity-${rarityClass}`;
                        card.innerHTML = `
                            <div class="flex-grow">
                                <h3 class="text-xl font-cinzel font-bold text-yellow-100">${item.name}</h3>
                                <h4 class="text-lg font-cinzel text-gray-400 italic">${item.englishName}</h4>
                                <div class="mt-4">
                                    <p class="text-lg text-yellow-400 font-bold">${priceDisplay}</p>
                                    <p class="text-md text-rarity-${rarityClass} font-bold capitalize">${item.rarity}</p>
                                </div>
                            </div>
                            <div class="mt-4">
                                <button class="toggle-desc-btn w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Ver Descrição</button>
                                <div class="item-description">
                                    ${item.description}
                                </div>
                            </div>
                        `;
                        grid.appendChild(card);
                    });
                    
                    section.appendChild(grid);
                    shopContainer.appendChild(section);
                }
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            fetch('itens.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    allItems = data;
                    renderItems(); // Renderiza todos os itens inicialmente
                })
                .catch(error => {
                    console.error('Falha ao carregar o arquivo de itens:', error);
                    shopContainer.innerHTML = `<p class="text-center text-red-500 text-xl">Falha ao carregar os tesouros de Sigil. O arquivo <em>itens.json</em> não foi encontrado ou está corrompido.</p>`;
                });
            
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                renderItems(e.target.value);
            });

             shopContainer.addEventListener('click', e => {
                if (e.target.classList.contains('toggle-desc-btn')) {
                    const descContainer = e.target.nextElementSibling;
                    if (descContainer) {
                        const isHidden = descContainer.style.display === 'none' || descContainer.style.display === '';
                        descContainer.style.display = isHidden ? 'block' : 'none';
                        e.target.textContent = isHidden ? 'Ocultar Descrição' : 'Ver Descrição';
                    }
                }
            });
        });

        // Funções do botão "Voltar ao Topo"
        const backToTopBtn = document.getElementById("backToTopBtn");
        window.onscroll = function() {
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                backToTopBtn.style.display = "block";
            } else {
                backToTopBtn.style.display = "none";
            }
        };
        function scrollToTop() {
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    </script>

</body>
</html>

